[
  
      {
        "title"    : "Authentification",
        "category" : "API",
        "tags"     : "",
        "url"      : "https://sigrennesmetropole.github.io/rudi_documentation/api/authentification/",
        "date"     : "2022-02-17 16:49:26 +0100",
        "excerpt"  : "Authentification des fournisseurs de données\n",
        "content"  : "Authentification des fournisseurs de données\n\nLes fournisseurs de données pour publier des métadonnées doivent s’authentifier en OAuth2.\n\nPour cela, il faut :\n\n  Déclarer le fournisseur dans RUDI Portail (µPoviders)\n  Déclarer chaque noeud du fournisseur dans RUDI Portail (µPoviders)\n  \n    A chaque noeud est associé un utilisateur de type ROBOT  (µACL). L’utilisateur possède :\n\n    \n      un client_id sous la forme d’un UUID V4\n      un client_secret\n    \n  \n\n\nLe noeud fournisseur peut alors s’authentifier comme suit :\n\n\ncurl -v --request POST http://&lt;server&gt;:&lt;port&gt;/oauth/token --data \"grant_type=password\" --data \"username=&lt;username&gt;\" --data \"password=&lt;client_password&gt;\" --data \"scope=&lt;liste des scopes séparés par des virgules&gt;\" --data \"client_id=&lt;client_id&gt;\" -H \"Authorization:Basic &lt;encodage en base 64 de la chaine &amp;lt:client_id:client_password&gt;\"\n\n\n\n\nContrôle de l’authentification appel du Portail RUDI vers un fournisseur de données\n\nLorsque le portail vient moissonner des données d’un fournisseur de données ou lorsque le portail vient soumettre un rapport d’intégration, l’appel comporte une entête d’authorization de type “Bearer”.\n\nExemple :\n\nAuthorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJydWRpIiwiY29ubmVjdGVkVXNlciI6eyJsb2dpbiI6InJ1ZGkiLCJ0eXBlIjoiUEVSU09OIiwiZmlyc3RuYW1lIjoicnVkaSIsImxhc3RuYW1lIjoicnVkaSIsImVtYWlsIjpudWxsLCJvcmdhbml6YXRpb24iOiJydWRpIiwicm9sZXMiOlsiQURNSU5JU1RSQVRPUiJdfSwiZXhwIjoxNjE0NjE5Nzc2LCJpYXQiOjE2MTQ2MTYxNzZ9.Em7yclposciDOll-Dgv9O6jGDE-GsVEHp9dYKyfYNCyPTAambdGqtnl--Zw0DidCf0_JCghXlpznMIteUPdHnQ\n\n\nLe fournisseur de données peut valider ce token en réalisant l’appel suivant vers le portail :\n\n\ncurl -v --request GET http://&lt;server&gt;:&lt;port&gt;/oauth/check_token?token=&amp;ltvaleur du token&gt;\n\n\nAuthentification des porteurs de projets\n\nLorsqu’un porteur de projet souhaite utiliser un jeu de données exposé par le portail, il peut le faire\n\n  soit en son nom. C’est le cas de tous les jeux de données à accès restreint et c’est aussi le cas si le porteur de projet souhaite une qualité de service particulière. Il est important de noter que pour effectuer ce mode d’authentification, il faut un utilisateur Rudi (création de compte depuis le portail) et que cet utilisateur ait souscrit aux différents jeux de données.\n  soit en tant qu’utilisateur anonyme. Cette possibilité est proposée afin de permettre à un porteur de réaliser des essais rapidement. Le mot de passe de cet utilisateur est “anonymous” et son login est “anonymous”.\n\n\nDans le cas d’une utilisation en tant qu’utilisateur anonyme, il faut :\n\n  s’authentifier auprès du portail en tant que “anonymous” et récupérer un token JWT Rudi\n\n\n\ncurl -v -X POST https://rudi.bzh/token -d \"grant_type=password&amp;username=anonymous&amp;password=anonymous\" -H \"Authorization: Basic TEgxT1o1T3JMZmRFcXlRdkozcEFvUzhieFFNYTpYYWdmOENRdEpzak1UV09pdnBueGxjbTczb0lh\"\n\n\n\n  à partir du token il est alors possible d’accéder aux APIs de téléchargement comme suit :\n\n\nAppel de l’API de téléchargement pour le media souscrit :\n\ncurl -v -X GET  \"https://rudi.bzh/medias/eef6832f-6a06-4f65-8f95-a533ac8926a7/dwnl/1.0.0\" -H \"Authorization: Bearer [l'access token retourné par l'appel précédent]\" \n\n\nPour une accès en son nom propre (éléments en cours de définition coté portail et non disponible actuellement sur rudi.bzh), il faut :\n\n  Se connecter sur le portail avec son compte utilisateur\n  Accéder au détail du compte\n  Activer l’utilisation des APIs\n  Récupérer le couple “customer_key”/customer_secret”\n  Utiliser ce couple pour s’authentifier :\n\n\n\ncurl -kv -X POST -H \"Authorization: Basic [base64(customer_key:customer_secret)]\" -d \"grant_type=client_credentials&amp;username=[login du user sur le portail associé au customer_key]&amp;scope=apim:subscribe apim:app_manage\" -H \"Content-Type:application/x-www-form-urlencoded\" https://rudi.bzh/apim/oauth2/token\n\n\nCet appel permet de récupérer un token.\n\n\n  à partir du token il est alors possible d’accéder aux APIs de téléchargement comme suit :\n\n\n\ncurl -kv -X POST -H \"Authorization: Bearer \" https://rudi.bzh/apim/datasets/02777fcb-c0bd-4d89-830a-8070cfb89261/dwnl/1.0.0\n&lt;/pre&gt;\n\n"
      }]
